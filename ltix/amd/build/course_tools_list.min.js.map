{"version":3,"file":"course_tools_list.min.js","sources":["../src/course_tools_list.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course LTI External tools list management.\n *\n * @module      core_ltix/course_tools_list\n * @copyright   2023 Jake Dallimore <jrhdallimore@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport Ajax from 'core/ajax';\nimport {add as addToast} from 'core/toast';\nimport {getString, getStrings} from 'core/str';\nimport {refreshTableContent} from 'core_table/dynamic';\nimport * as Selectors from 'core_table/local/dynamic/selectors';\nimport ModalForm from 'core_form/modalform';\n\n/**\n * Initialise module.\n */\nexport const init = () => {\n    document.addEventListener('click', event => {\n\n        const courseToolDelete = event.target.closest('[data-action=\"course-tool-delete\"]');\n        if (courseToolDelete) {\n            event.preventDefault();\n\n            const requiredStrings = [\n                {key: 'deletecoursetool', component: 'core_ltix', param: courseToolDelete.dataset.courseToolName},\n                {key: 'deletecoursetoolconfirm', component: 'core_ltix', param: courseToolDelete.dataset.courseToolName},\n                {key: 'delete', component: 'core', param: courseToolDelete.dataset.courseToolName},\n                {key: 'coursetooldeleted', component: 'core_ltix', param: courseToolDelete.dataset.courseToolName}\n            ];\n            // Use triggerElement to return focus to the action menu toggle.\n            const triggerElement = courseToolDelete.closest('.dropdown').querySelector('.dropdown-toggle');\n\n            getStrings(requiredStrings).then(([modalTitle, modalBody, deleteLabel]) => {\n                return Notification.deleteCancelPromise(\n                    modalTitle,\n                    modalBody,\n                    deleteLabel,\n                    {triggerElement});\n            }).then(() => {\n                const pendingPromise = new Pending('core_ltix/course_tools:delete');\n\n                const request = {\n                    methodname: 'core_ltix_delete_course_tool_type',\n                    args: {tooltypeid: courseToolDelete.dataset.courseToolId}\n                };\n                return Ajax.call([request])[0]\n                    .then(addToast(getString('coursetooldeleted', 'core_ltix', courseToolDelete.dataset.courseToolName)))\n                    .then(() => {\n                        const tableRoot = triggerElement.closest(Selectors.main.region);\n                        return refreshTableContent(tableRoot);\n                    })\n                    .then(pendingPromise.resolve)\n                    .catch(Notification.exception);\n            }).catch(() => {\n                return;\n            });\n        }\n\n        // Manage placements context menu.\n        const courseToolManagePlacements = event.target.closest('[data-action=\"manage-placements\"]');\n        if (courseToolManagePlacements) {\n            event.preventDefault();\n\n            const modalForm = new ModalForm({\n                modalConfig: {\n                    title: getString('manageplacements', 'core_ltix'),\n                },\n                formClass: '\\\\core_ltix\\\\form\\\\manage_placements_form',\n                args: {\n                    toolid: courseToolManagePlacements.dataset.toolid,\n                    courseid: courseToolManagePlacements.dataset.courseid,\n                },\n                saveButtonText: getString('apply', 'core'),\n                returnFocus: courseToolManagePlacements,\n            });\n\n            // Show a toast notification when the form is submitted.\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                addToast(getString('placementstatussaved', 'core_ltix'))\n                .then(() => {\n                    const tableRoot = courseToolManagePlacements.closest(Selectors.main.region);\n                    return refreshTableContent(tableRoot);\n                })\n                .catch(Notification.exception);\n            });\n\n            modalForm.show();\n        }\n    });\n};\n"],"names":["document","addEventListener","event","courseToolDelete","target","closest","preventDefault","requiredStrings","key","component","param","dataset","courseToolName","triggerElement","querySelector","then","_ref","modalTitle","modalBody","deleteLabel","Notification","deleteCancelPromise","pendingPromise","Pending","request","methodname","args","tooltypeid","courseToolId","Ajax","call","tableRoot","Selectors","main","region","resolve","catch","exception","courseToolManagePlacements","modalForm","ModalForm","modalConfig","title","formClass","toolid","courseid","saveButtonText","returnFocus","events","FORM_SUBMITTED","show"],"mappings":"qjDAqCoB,KAChBA,SAASC,iBAAiB,SAASC,cAEzBC,iBAAmBD,MAAME,OAAOC,QAAQ,yCAC1CF,iBAAkB,CAClBD,MAAMI,uBAEAC,gBAAkB,CACpB,CAACC,IAAK,mBAAoBC,UAAW,YAAaC,MAAOP,iBAAiBQ,QAAQC,gBAClF,CAACJ,IAAK,0BAA2BC,UAAW,YAAaC,MAAOP,iBAAiBQ,QAAQC,gBACzF,CAACJ,IAAK,SAAUC,UAAW,OAAQC,MAAOP,iBAAiBQ,QAAQC,gBACnE,CAACJ,IAAK,oBAAqBC,UAAW,YAAaC,MAAOP,iBAAiBQ,QAAQC,iBAGjFC,eAAiBV,iBAAiBE,QAAQ,aAAaS,cAAc,wCAEhEP,iBAAiBQ,MAAKC,WAAEC,WAAYC,UAAWC,yBAC/CC,sBAAaC,oBAChBJ,WACAC,UACAC,YACA,CAACN,eAAAA,oBACNE,MAAK,WACEO,eAAiB,IAAIC,iBAAQ,iCAE7BC,QAAU,CACZC,WAAY,oCACZC,KAAM,CAACC,WAAYxB,iBAAiBQ,QAAQiB,sBAEzCC,cAAKC,KAAK,CAACN,UAAU,GACvBT,MAAK,eAAS,kBAAU,oBAAqB,YAAaZ,iBAAiBQ,QAAQC,kBACnFG,MAAK,WACIgB,UAAYlB,eAAeR,QAAQ2B,UAAUC,KAAKC,eACjD,gCAAoBH,cAE9BhB,KAAKO,eAAea,SACpBC,MAAMhB,sBAAaiB,cACzBD,OAAM,eAMPE,2BAA6BpC,MAAME,OAAOC,QAAQ,wCACpDiC,2BAA4B,CAC5BpC,MAAMI,uBAEAiC,UAAY,IAAIC,mBAAU,CAC5BC,YAAa,CACTC,OAAO,kBAAU,mBAAoB,cAEzCC,UAAW,4CACXjB,KAAM,CACFkB,OAAQN,2BAA2B3B,QAAQiC,OAC3CC,SAAUP,2BAA2B3B,QAAQkC,UAEjDC,gBAAgB,kBAAU,QAAS,QACnCC,YAAaT,6BAIjBC,UAAUtC,iBAAiBsC,UAAUS,OAAOC,gBAAgB,qBAC/C,kBAAU,uBAAwB,cAC1ClC,MAAK,WACIgB,UAAYO,2BAA2BjC,QAAQ2B,UAAUC,KAAKC,eAC7D,gCAAoBH,cAE9BK,MAAMhB,sBAAaiB,cAGxBE,UAAUW"}